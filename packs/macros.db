{"name":"Rencontres-liste","type":"script","author":"xpmn06gsVqM6GKoq","img":"icons/svg/terror.svg","scope":"global","command":"game.naheulbeuk.macros.rencontre();","folder":null,"sort":0,"permission":{"default":0,"OUcPs2xihm1UvIIi":3,"xpmn06gsVqM6GKoq":3},"flags":{"core":{"sourceId":"Macro.B5Cv4LihS4qCa5pa"}},"_id":"6JlDRm2jeI5EZUJG"}
{"name":"Combat rapide","type":"script","author":"SFOIchF0UTpc8INi","img":"icons/svg/combat.svg","scope":"global","command":"//on récupère l'acteur source\nconst source = game.naheulbeuk.macros.getSpeakersActor()\n//on récupère l'acteur cible\nconst cible = game.naheulbeuk.macros.getSpeakersTarget()\n//on initie la recherche d'une arme à 0\nvar arme = 0;\n//on initie la recherche le nom de l'arme / attaque\nvar nom_arme = \"\";\n//on initie la recherche de la valeur d'attaque à ?\nvar attaque = \"?\";\n//si la source est un PJ\nif (source.type==\"character\") {\n  //pour chaque objet de la source\n  for (item of source.data.items){\n    //si l'objet est en mains et a une formule = c'est une arme éligible à l'attaque rapide\n    if (item.data.data.enmain==true && item.data.data.formula!=\"\" && item.data.data.formula!=\"-\") {\n      //si on en trouve plusieurs (pas normal) on prévient\n      if (arme!=0){ui.notifications.error(\"Attention, plusieurs armes en mains ont été trouvées\");}\n      arme=item\n    }\n  }\n  //si c'est une arme de cac\n  if (arme.data.data.lancerarme==\"-\"){\n    //on récupère la valeur d'attaque du perso\n    attaque=game.naheulbeuk.macros.replaceAttr(\"@att\",source)\n    //et on ajoute le bonus/malus de l'arme\n    attaque=parseInt(attaque)+parseInt(arme.data.data.att)\n    //on récupère le nom de l'arme\n    nom_arme=arme.data.name\n  //si l'arme est à distance on prévient qu'on ne fait pas de combat rapide\n  } else {\n    ui.notifications.error(\"Pas de combat rapide pour les armes à distance, utiliser les jets de combat classique\");\n  }\n//si la source est un PNJ\n} else {\n  //pour chaque objet de la source\n  for (item of source.data.items){\n    //si c'est une attaque avec une épreuve d'attaque\n    if (item.data.type==\"attaque\" && item.data.data.attaque!=\"\" && item.data.data.attaque!=\"-\"){\n      //si c'est la première attaque trouver\n      if (attaque==\"?\") {\n        //on récupère la valeur d'attaque avec les bonus/malus éventuels du PNJ\n        attaque=parseInt(item.data.data.attaque) + parseInt(game.naheulbeuk.macros.replaceAttr(\"@att\",source))\n        //on récupère le nom de l'attaque\n        nom_arme=item.data.name\n      //si on a trouvé plusieurs attaque\n      } else {\n        //on récupère les nouvelles valeurs d'attaque et de nom\n        let nouvelle_attaque = parseInt(item.data.data.attaque) + parseInt(game.naheulbeuk.macros.replaceAttr(\"@att\",source))\n        let nouveau_nom = item.data.name\n        //on ajoute ces valeurs aux anciennes\n        attaque = attaque + \" / \" + nouvelle_attaque\n        nom_arme = nom_arme + \" / \" + nouveau_nom\n      }\n    }\n  }\n}\n//on récupère la valeur d'esquive de la cible\nvar cible_esq=parseInt(game.naheulbeuk.macros.replaceAttr(\"@esq\",cible))\n//on récupère la valeur de parade de la cible\nvar cible_prd=parseInt(game.naheulbeuk.macros.replaceAttr(\"@prd\",cible))\n//Si la cible est un PNJ, on applique le bonus/malus d'adresse à l'esquive\nif (cible.type==\"npc\") {\n  cible_esq=cible_esq+parseInt(game.naheulbeuk.macros.replaceAttr(\"@ad\",cible))\n}\n\n//on fait une nouvelle interface\nlet d = new Dialog({\n  title: \"Attaque rapide\",\n  content: `\n    <label style=\"font-size: 15px;\">Attaque `+ nom_arme +` :</label>\n    <input style=\"font-size: 15px;\" type=\"text\" name=\"inputFormule\" value=\"`+ attaque + `\">\n    <br/><br/>\n    <label style=\"font-size: 15px;\">Parade ou esquive ?</label>\n    <select name=\"inputDiff\">\n      <option value=\"prd\">Parade</option>\n      <option value=\"esq\">Esquive</option>\n    </select>\n    <br/><br/>\n    <label style=\"font-size: 15px;\">Bonus/Malus du seuil :</label>\n    <input style=\"font-size: 15px;\" type=\"text\" name=\"inputSeuil\" value=\"\">\n    <br/><br/>\n    `,\n  buttons: {\n    one: {\n      label: \"Calculer le seuil\",\n      callback: (html) => {\n        //on récupère les valeurs du formulaire\n        let attaque = parseInt(html.find('input[name=\"inputFormule\"').val());\n        let prd = html.find('select[name=\"inputDiff\"').val();\n        //si l'utilisateur a choisi une parade ou un esquive, on affecte la bonne valeur sans la révéler\n        if (prd == \"prd\"){prd = cible_prd}\n        if (prd == \"esq\"){prd = cible_esq}\n        if (html.find('input[name=\"inputSeuil\"').val()!=\"\"){var mod_seuil = parseInt(html.find('input[name=\"inputSeuil\"').val())}else{var mod_seuil=0}\n        //on initie la tableau de seuil\n        let table = [['PR-AT',1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22],\n        [1,1,3,5,7,9,11,13,15,17,19,20,20,20,20,20,20,20,20,20,20,20,20],\n        [2,1,2,4,6,8,10,12,14,16,18,19,20,20,20,20,20,20,20,20,20,20,20],\n        [3,1,2,3,5,7,9,11,13,15,17,18,19,20,20,20,20,20,20,20,20,20,20],\n        [4,1,1,2,4,6,8,10,12,14,16,18,18,19,20,20,20,20,20,20,20,20,20],\n        [5,1,1,2,4,5,7,9,11,13,15,17,18,18,19,19,20,20,20,20,20,20,20],\n        [6,1,1,1,3,5,6,8,10,12,14,16,17,18,18,19,19,20,20,20,20,20,20],\n        [7,1,1,1,3,4,6,7,9,11,13,15,17,17,18,18,19,19,20,20,20,20,20],\n        [8,1,1,1,2,4,5,7,8,10,12,14,16,17,17,18,18,19,19,20,20,20,20],\n        [9,1,1,1,2,3,5,7,8,9,11,13,15,15,17,17,18,18,19,19,20,20,20],\n        [10,1,1,1,1,3,4,6,8,8,10,12,14,16,16,17,17,18,18,19,19,20,20],\n        [11,1,1,1,1,2,4,6,7,8,9,11,13,14,15,16,16,17,17,18,18,19,20],\n        [12,1,1,1,1,2,3,5,7,7,9,11,11,13,14,15,15,16,16,17,17,18,18],\n        [13,1,1,1,1,1,3,5,6,7,8,10,11,12,13,14,15,15,16,16,17,17,18],\n        [14,1,1,1,1,1,2,4,6,6,8,10,10,12,12,13,14,14,15,15,16,16,17],\n        [15,1,1,1,1,1,2,4,5,6,7,9,10,11,12,13,14,14,15,15,16,16,17],\n        [16,1,1,1,1,1,1,3,5,5,7,9,9,10,11,13,13,14,14,15,15,16,16],\n        [17,1,1,1,1,1,1,3,4,5,6,8,8,9,10,12,13,14,14,15,15,16,16],\n        [18,1,1,1,1,1,1,2,4,4,6,8,8,9,10,11,12,14,14,15,15,16,16],\n        [19,1,1,1,1,1,1,2,3,4,5,7,7,8,9,11,11,13,14,15,15,16,16],\n        [20,1,1,1,1,1,1,1,3,3,5,6,7,7,8,10,11,12,13,15,15,16,16],\n        [21,1,1,1,1,1,1,1,2,3,4,5,6,6,7,9,10,11,12,14,15,16,17],\n        [22,1,1,1,1,1,1,1,2,2,3,4,5,6,7,8,9,10,11,13,14,16,17]];\n        //on calcule le seuil avec les bonus/malus éventuel\n        let seuil = table[prd][attaque+mod_seuil];\n        //on lance un jet de d20, de difficulté le seuil\n        game.naheulbeuk.macros.customRoll(\"d20\",seuil.toString())\n      }\n    }\n  }\n});\nd.render(true);","folder":null,"sort":0,"permission":{"default":0,"SFOIchF0UTpc8INi":3},"flags":{"core":{"sourceId":"Macro.EQEEI2hP4HuzYPIj"}},"_id":"QIMFtgv6G5It52oR"}
{"name":"Rechercher un compendium du système","type":"script","author":"OUcPs2xihm1UvIIi","img":"icons/svg/eye.svg","scope":"global","command":"game.naheulbeuk.macros.compendiumSearch();","folder":null,"sort":0,"permission":{"default":0,"OUcPs2xihm1UvIIi":3},"flags":{"core":{"sourceId":"Macro.47hPaN5tDCHn9ouJ"}},"_id":"TlIsgCClC02kdY4b"}
{"name":"Rencontres-générateur","type":"script","author":"xpmn06gsVqM6GKoq","img":"icons/svg/skull.svg","scope":"global","command":"game.naheulbeuk.macros.listrencontreprep()","folder":null,"sort":0,"permission":{"default":0,"xpmn06gsVqM6GKoq":3},"flags":{"core":{"sourceId":"Macro.piI4BhpL2QgpBCj7"}},"_id":"UUwJlCfLpKl4Dnbh"}
{"_id":"k2nyuxe07fWlUBuY","name":"Lancer custom","type":"script","author":"OUcPs2xihm1UvIIi","img":"icons/svg/d20.svg","scope":"global","command":"let dice=\"d20\"; //lancer de dés\nlet diff=\"\"//difficulté\n//Raccoucis possibles : @cou @int @cha @ad @fo @att @prd @lvl @pr @prm @esq @rm @mphy @mpsy\n//----------------------------------------------------//\n\ngame.naheulbeuk.macros.customRoll(dice,diff)","folder":null,"sort":0,"permission":{"default":0,"OUcPs2xihm1UvIIi":3},"flags":{"core":{"sourceId":"Macro.Vt59LtIyk71j08E3"}}}
{"name":"Tirer un élément aléatoire d'un compendium","type":"script","author":"OUcPs2xihm1UvIIi","img":"icons/svg/sun.svg","scope":"global","command":"game.naheulbeuk.macros.compendiumAlea();","folder":null,"sort":0,"permission":{"default":0,"OUcPs2xihm1UvIIi":3},"flags":{"core":{"sourceId":"Macro.pyMs0vTmGs57UW06"}},"_id":"qbj1lmTMNjqc7h6L"}
