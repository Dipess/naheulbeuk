{"name":"Rencontres-liste","type":"script","author":"xpmn06gsVqM6GKoq","img":"icons/svg/terror.svg","scope":"global","command":"game.naheulbeuk.macros.rencontre();","folder":null,"sort":0,"flags":{"core":{"sourceId":"Macro.B5Cv4LihS4qCa5pa"}},"_id":"6JlDRm2jeI5EZUJG","ownership":{"default":0,"OUcPs2xihm1UvIIi":3,"xpmn06gsVqM6GKoq":3},"_stats":{"systemId":"naheulbeuk","systemVersion":"2.0.0.0","coreVersion":"10.288","createdTime":null,"modifiedTime":1668096452237,"lastModifiedBy":"0E9CYtfvZEhk1ACo"}}
{"name":"Chercher un objet et générer un magasin","type":"script","author":"SFOIchF0UTpc8INi","img":"icons/svg/daze.svg","scope":"global","command":"game.naheulbeuk.macros.magic_search()","folder":null,"sort":0,"flags":{"core":{"sourceId":"Macro.Gg9Z11uYlT9HPUlK"}},"_id":"IyOrSDP9N3btpofo","ownership":{"default":0,"SFOIchF0UTpc8INi":3},"_stats":{"systemId":"naheulbeuk","systemVersion":"2.0.0.0","coreVersion":"10.288","createdTime":null,"modifiedTime":1668096451143,"lastModifiedBy":"0E9CYtfvZEhk1ACo"}}
{"name":"Rechercher un compendium du système","type":"script","author":"OUcPs2xihm1UvIIi","img":"icons/svg/eye.svg","scope":"global","command":"game.naheulbeuk.macros.compendiumSearch();","folder":null,"sort":0,"flags":{"core":{"sourceId":"Macro.47hPaN5tDCHn9ouJ"}},"_id":"TlIsgCClC02kdY4b","ownership":{"default":0,"OUcPs2xihm1UvIIi":3},"_stats":{"systemId":"naheulbeuk","systemVersion":"2.0.0.0","coreVersion":"10.288","createdTime":null,"modifiedTime":1668096451839,"lastModifiedBy":"0E9CYtfvZEhk1ACo"}}
{"name":"Rencontres-générateur","type":"script","author":"xpmn06gsVqM6GKoq","img":"icons/svg/skull.svg","scope":"global","command":"game.naheulbeuk.macros.listrencontreprep()","folder":null,"sort":0,"flags":{"core":{"sourceId":"Macro.piI4BhpL2QgpBCj7"}},"_id":"UUwJlCfLpKl4Dnbh","ownership":{"default":0,"xpmn06gsVqM6GKoq":3},"_stats":{"systemId":"naheulbeuk","systemVersion":"2.0.0.0","coreVersion":"10.288","createdTime":null,"modifiedTime":1668096452040,"lastModifiedBy":"0E9CYtfvZEhk1ACo"}}
{"name":"Combat rapide - by doudlink <3","type":"script","author":"0E9CYtfvZEhk1ACo","img":"icons/svg/combat.svg","scope":"global","command":"//on récupère l'acteur source\nconst source = game.naheulbeuk.macros.getSpeakersActor();\n//on récupère l'acteur cible\nconst cible = game.naheulbeuk.macros.getSpeakersTarget();\n//on initie la recherche de l'att/prd des armes\nvar att_armes = [];\nvar prd_armes = [];\nvar deg_armes = [];\n//on initie la recherche le nom des armes\nvar nom_armes = [];\nvar nom_prd = [];\n//on initie la recherche de la valeur d'attaque à ?\nvar attaque = \"?\";\n\n//si la source est un PJ\nif (source.type == \"character\") {\n    //pour chaque objet de la source\n    for (item of source.items) {\n        //si l'objet est en mains et a une formule = c'est une arme éligible à l'attaque rapide\n        if (item.system.enmain == true && item.system.formula != \"\" && item.system.formula != \"-\") {\n            //on ajoute les info de l'arme aux listes correspondates\n            //si c'est une arme de cac\n            if (item.system.att_arme_jet == \"-\") {\n                if (nom_armes.length != 0) {\n                    ui.notifications.error(\"Attention, plusieurs armes en mains ont été trouvées\");\n                }\n                //on récupère le nom de l'arme\n                nom_armes.push(item.name);\n                //on récupère l'attaque avec l'arme\n                att_armes.push(parseInt(game.naheulbeuk.macros.replaceAttr(\"@att\", source)) + parseInt(item.system.att));\n                //on récupère les dégâts de l'arme\n                deg_armes.push(item.system.formula);\n            } else {\n                ui.notifications.error(\"Pour les armes à distance, utilisez le combat rapide à distance\");\n            }\n        }\n    }\n    //si la source est un PNJ\n} else {\n    //pour chaque objet de la source\n    for (item of source.items) {\n        //si c'est une attaque avec une épreuve d'attaque\n        if (item.type == \"attaque\" && item.system.attaque != \"\" && item.system.attaque != \"-\") {\n            //on récupère l'attaque de l'arme\n            att_armes.push(parseInt(item.system.attaque));\n            //on récupère le nom de l'arme\n            nom_armes.push(item.name);\n            //on récupère les dégâts de l'arme\n            deg_armes.push(item.system.formula);\n        }\n    }\n}\n//on récupère la valeur d'esquive de la cible\nvar cible_esq = parseInt(game.naheulbeuk.macros.replaceAttr(\"@esq\", cible));\n//on récupère la valeur de parade de la cible\nvar cible_prd = parseInt(game.naheulbeuk.macros.replaceAttr(\"@prd\", cible));\n//Si la cible est un PNJ, on applique le bonus/malus d'adresse à l'esquive\nif (cible.type == \"npc\") {\n    cible_esq = cible_esq + parseInt(game.naheulbeuk.macros.replaceAttr(\"@ad\", cible))\n}\n\n//on fait une nouvelle interface\n//selection de l'arme\nvar txt = `<label style=\"font-size: 15px;\">Attaque :</label>\n\t\t   <select name=\"inputDiff1\">\\n`;\nfor (var i = 0; i < att_armes.length; i++) {\n    txt += '<option value=\"' + i + '\">' + nom_armes[i] + '</option>\\n'\n}\ntxt += `</select>\n    <br/><br/>`\n\n//sélection de la parade ou l'esquive\ntxt += `<label style=\"font-size: 15px;\">Parade ou esquive ?</label>\n    <select name=\"inputDiff2\" onchange=\"show(this)\">\n      <option value=\"prd\">Parade</option>\n      <option value=\"esq\">Esquive</option>\n\t  <option value=\"fat\">Parade consommée</option>\n    </select>\n    <br/><br/>`\n\n//prise en compte de l'arme de la cible pour la parade si c'est un pj\nif (cible.type == \"character\") {\n    txt += `<div id=arme_prd>\n        <label style=\"font-size: 15px;\">Arme de parade :</label>\n\t\t<select name=\"inputDiff3\">`;\n    //pour chaque objet de la cible\n    for (item of cible.items) {\n        //si l'objet est en mains et a une formule = c'est une arme éligible à l'attaque rapide\n        if (item.system.enmain == true) {\n            if (item.system.prd != \"-\") {\n                nom_prd.push(item.name);\n                prd_armes.push(parseInt(game.naheulbeuk.macros.replaceAttr(\"@prd\", cible)) + parseInt(item.system.prd));\n            } else {\n                ui.notifications.error(\"Pas de parade possible avec cette arme\");\n            }\n        }\n    }\n    //ajout au menu déroulant\n    for (var i = 0; i < prd_armes.length; i++) {\n        txt += '<option value=\"' + i + '\">' + nom_prd[i] + '</option>'\n    }\n    txt += `</select>\n        <br/><br/>\n\t\t</div>\n\t\t<script>\n\t\t\tfunction show(prd_esq) {\n\t\t\t\tif (prd_esq.value != \"prd\") {\n\t\t\t\t\tdocument.getElementById('arme_prd').style.display = 'none';\n\t\t\t\t} else {\n\t\t\t\t\tdocument.getElementById('arme_prd').style.display = 'block';\n\t\t\t\t}\n\t\t\t\t\n\t\t\t}\n\t\t</script>`;\n}\n\n//prise en compte de la position et autres bonus/malus\ntxt += `<label style=\"font-size: 15px;\">Positionnement :</label>\n\t<div>\n\t  <input type=\"radio\" id=\"face\" name=\"pos\" value=0 checked>Face\n\t  \n      <input type=\"radio\" id=\"flc\" name=\"pos\" value=2>Flanc\n\t  \n      <input type=\"radio\" id=\"arr\" name=\"pos\" value=5>Arrière\n\t</div>\n\t<br/>\n    <label style=\"font-size: 15px;\">Bonus/Malus du seuil :</label>\n    <br/><em>+1 pour chaque allié en soutien<br/>-5 pour la 2ème attaque d'un héros ambidextre</em><br/>\n    <input style=\"font-size: 15px;margin-top:8px\" type=\"text\" name=\"inputSeuil\" value=\"\">\n    <br/><br/>\n\t`;\n\nvar d = new Dialog({\n    title: \"Attaque rapide\",\n    content: txt,\n    buttons: {\n        one: {\n            label: \"Combat rapide\",\n            callback: (html) => {\n                //on récupère les valeurs du formulaire\n                var index = parseInt(html.find('select[name=\"inputDiff1\"').val());\n                var attaque = att_armes[index];\n                var prd = html.find('select[name=\"inputDiff2\"').val();\n                var mod_pos = parseInt(html.find('input[name=\"pos\"]:checked').val());\n                //si l'utilisateur a choisi une parade ou un esquive, on affecte la bonne valeur sans la révéler\n                if (prd == \"prd\") {\n                    //si pj prise en compte des bonus/malus de l'objet en main\n                    if (cible.type == \"character\") {\n                        //la cible n'a pas d'arme avec laquelle parer\n                        if (prd_armes.length == 0) {\n                            prd = 1;\n                        } else {\n                            var index_prd = parseInt(html.find('select[name=\"inputDiff3\"').val());\n                            prd = prd_armes[index_prd];\n                        }\n                    } else {\n                        prd = cible_prd;\n                    }\n                    var textprd = \" tente une parade.\";\n                }\n                if (prd == \"esq\") {\n                    prd = cible_esq;\n                    var textprd = \" tente une esquive.\";\n                }\n                if (prd == \"fat\") {\n                    prd = 1;\n                    var textprd = \" ne se défend pas.\";\n                }\n                if (prd <= 0) {\n                    prd = 1;\n                }\n                if (prd > 22) {\n                    prd = 22;\n                }\n                //bonus/malus potentiel sur l'attaque\n                if (html.find('input[name=\"inputSeuil\"').val() != \"\") {\n                    var mod_seuil = parseInt(html.find('input[name=\"inputSeuil\"').val());\n                } else {\n                    var mod_seuil = 0;\n                }\n                //on initie la tableau de seuil\n                const table = [['PR-AT', 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22],\n                    [1, 1, 3, 5, 7, 9, 11, 13, 15, 17, 19, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20],\n                    [2, 1, 2, 4, 6, 8, 10, 12, 14, 16, 18, 19, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20],\n                    [3, 1, 2, 3, 5, 7, 9, 11, 13, 15, 17, 18, 19, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20],\n                    [4, 1, 1, 2, 4, 6, 8, 10, 12, 14, 16, 18, 18, 19, 20, 20, 20, 20, 20, 20, 20, 20, 20],\n                    [5, 1, 1, 2, 4, 5, 7, 9, 11, 13, 15, 17, 18, 18, 19, 19, 20, 20, 20, 20, 20, 20, 20],\n                    [6, 1, 1, 1, 3, 5, 6, 8, 10, 12, 14, 16, 17, 18, 18, 19, 19, 20, 20, 20, 20, 20, 20],\n                    [7, 1, 1, 1, 3, 4, 6, 7, 9, 11, 13, 15, 17, 17, 18, 18, 19, 19, 20, 20, 20, 20, 20],\n                    [8, 1, 1, 1, 2, 4, 5, 7, 8, 10, 12, 14, 16, 17, 17, 18, 18, 19, 19, 20, 20, 20, 20],\n                    [9, 1, 1, 1, 2, 3, 5, 7, 8, 9, 11, 13, 15, 15, 17, 17, 18, 18, 19, 19, 20, 20, 20],\n                    [10, 1, 1, 1, 1, 3, 4, 6, 8, 8, 10, 12, 14, 16, 16, 17, 17, 18, 18, 19, 19, 20, 20],\n                    [11, 1, 1, 1, 1, 2, 4, 6, 7, 8, 9, 11, 13, 14, 15, 16, 16, 17, 17, 18, 18, 19, 20],\n                    [12, 1, 1, 1, 1, 2, 3, 5, 7, 7, 9, 11, 11, 13, 14, 15, 15, 16, 16, 17, 17, 18, 18],\n                    [13, 1, 1, 1, 1, 1, 3, 5, 6, 7, 8, 10, 11, 12, 13, 14, 15, 15, 16, 16, 17, 17, 18],\n                    [14, 1, 1, 1, 1, 1, 2, 4, 6, 6, 8, 10, 10, 12, 12, 13, 14, 14, 15, 15, 16, 16, 17],\n                    [15, 1, 1, 1, 1, 1, 2, 4, 5, 6, 7, 9, 10, 11, 12, 13, 14, 14, 15, 15, 16, 16, 17],\n                    [16, 1, 1, 1, 1, 1, 1, 3, 5, 5, 7, 9, 9, 10, 11, 13, 13, 14, 14, 15, 15, 16, 16],\n                    [17, 1, 1, 1, 1, 1, 1, 3, 4, 5, 6, 8, 8, 9, 10, 12, 13, 14, 14, 15, 15, 16, 16],\n                    [18, 1, 1, 1, 1, 1, 1, 2, 4, 4, 6, 8, 8, 9, 10, 11, 12, 14, 14, 15, 15, 16, 16],\n                    [19, 1, 1, 1, 1, 1, 1, 2, 3, 4, 5, 7, 7, 8, 9, 11, 11, 13, 14, 15, 15, 16, 16],\n                    [20, 1, 1, 1, 1, 1, 1, 1, 3, 3, 5, 6, 7, 7, 8, 10, 11, 12, 13, 15, 15, 16, 16],\n                    [21, 1, 1, 1, 1, 1, 1, 1, 2, 3, 4, 5, 6, 6, 7, 9, 10, 11, 12, 14, 15, 16, 17],\n                    [22, 1, 1, 1, 1, 1, 1, 1, 2, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 13, 14, 16, 17]];\n                //on calcule le seuil avec les bonus/malus éventuel\n                var eval_seuil = attaque + mod_pos + mod_seuil;\n                if (eval_seuil > 22) {\n                    eval_seuil = 22;\n                }\n                if (eval_seuil < 1) {\n                    eval_seuil = 1;\n                }\n                var seuil = table[prd][eval_seuil];\n                //on lance un jet de d20, de difficulté le seuil et on envoie le résultat dans le chat\n                const rollMessageTpl = 'systems/naheulbeuk/templates/chat/skill-roll.hbs';\n                var diff = seuil.toString();\n                var r = new Roll(\"1d20\");\n                r.roll({\n                    \"async\": true\n                }).then(r => {\n                    var result = 0;\n                    var tplData = {};\n                    var reussite = \"Réussite !   \";\n                    diff = new Roll(diff);\n                    diff.roll({\n                        \"async\": true\n                    }).then(diff => {\n                        result = Math.abs(diff.total - r.total);\n                        if (r.total > diff.total) {\n                            reussite = \"Echec !   \";\n                        } else {\n                            var tplData2 = {};\n                            var degat = deg_armes[index];\n                            if (source.type == \"character\") {\n                                if (game.naheulbeuk.macros.replaceAttr(\"@fo\", source) > 12) {\n                                    degat = degat + \"+\" + Math.max(0, game.naheulbeuk.macros.replaceAttr(\"@fo\", source) - 12);\n                                };\n                                if (game.naheulbeuk.macros.replaceAttr(\"@fo\", source) < 9) {\n                                    degat = degat + \"-1\";\n                                };\n                            }\n                            deg = new Roll(degat);\n                            deg.roll({\n                                \"async\": true\n                            }).then(deg => {\n                                //préparation d'un message au GM indiquant les pv perdus\n                                var result2 = deg.total;\n                                //pr totale\n                                var c_pr = cible.system.attributes.pr;\n                                var pr = c_pr.value + c_pr.bonus + c_pr.bonus_man + parseInt(game.naheulbeuk.macros.replaceAttr(\"@prm\", cible));\n                                if (c_pr.trucdemauviette != undefined) {\n                                    pr += c_pr.trucdemauviette\n                                };\n                                //récupération de la vie max pour évaluer l'importance des dégâts\n                                var pv = cible.system.health.max;\n                                var d_pv = Math.floor(100 * (result2 - pr) / pv);\n                                if (result2 - pr == 1) {\n                                    txt = \"L'attaque fais l'effet d'une écharde.\"\n                                } else if (d_pv < 10) {\n                                    txt = \"L'attaque infliges des dégâts légers.\"\n                                } else if (d_pv < 20) {\n                                    txt = \"L'attaque infliges des dégâts corrects.\"\n                                } else if (d_pv < 35) {\n                                    txt = \"L'attaque infliges des dégâts remarquables.\"\n                                } else if (d_pv < 50) {\n                                    txt = \"L'attaque infliges des dégâts dangereux.\"\n                                } else {\n                                    txt = \"L'attaque infliges des dégâts dévastateurs.\"\n                                };\n                                //contenu du mp au GM\n                                if (result2 > pr) {\n                                    msg = '<i class=\"fas fa-heart\"></i><strong> PV perdus : ' + (result2 - pr) + '/' + pv + '</strong><br>' + txt;\n                                } else {\n                                    msg = `<i class=\"fas fa-heart\"></i><strong> PV perdus : 0</strong><br>L'attaque ne semble pas avoir pénétré son armure.`;\n                                };\n                                //gm or player\n                                var gm = false;\n                                if (source.type == \"npc\") {\n\t\t\t\t\t\t\t\t\tgm = true;\n\t\t\t\t\t\t\t\t};\n                                //message caché\n                                deg.toMessage({\n                                    flavor: msg\n                                }, {\n                                    rollMode: CONST.DICE_ROLL_MODES.BLIND\n                                });\n\t\t\t\t\t\t\t\t//message du lancer\n                                if (!gm) {\n                                    tplData2 = {\n                                        name: \"Dégâts\"\n                                    };\n                                    renderTemplate(rollMessageTpl, tplData2).then(msgFlavor => {\n                                        deg.toMessage({\n                                            user: game.user.id,\n                                            flavor: msgFlavor,\n                                            speaker: ChatMessage.getSpeaker({\n                                                actor: source\n                                            })\n                                        });\n                                    });\n                                };\n                            });\n                        };\n                        tplData = {\n                            diff: reussite + \" - Difficulté : \" + diff.total + \" - Ecart : \" + result,\n                            //nom de l'attaquant et de l'arme utilisée\n                            name: source.name + \" attaque avec \" + nom_armes[index] + \". \"+ cible.name + \"\" + textprd\n                        };\n                        renderTemplate(rollMessageTpl, tplData).then(msgFlavor => {\n                            r.toMessage({\n                                user: game.user.id,\n                                flavor: msgFlavor,\n                                speaker: ChatMessage.getSpeaker({\n                                    actor: source\n                                })\n                            });\n                        });\n                    });\n                });\n            }\n        }\n    }\n});\nd.render(true)","flags":{"core":{"sourceId":"Macro.EQEEI2hP4HuzYPIj"}},"ownership":{"default":0,"SFOIchF0UTpc8INi":3,"0E9CYtfvZEhk1ACo":3},"_stats":{"systemId":"naheulbeuk","systemVersion":"2.0.0.0","coreVersion":"10.288","createdTime":1667815398460,"modifiedTime":1668096451387,"lastModifiedBy":"0E9CYtfvZEhk1ACo"},"folder":null,"sort":0,"_id":"YmfsNlaEhjYExlBX"}
{"_id":"k2nyuxe07fWlUBuY","name":"Lancer custom","type":"script","author":"OUcPs2xihm1UvIIi","img":"icons/svg/d20.svg","scope":"global","command":"//----------------------------------------------------//\nlet dice=\"d20\"; //lancer de dés\nlet diff=\"\"//difficulté\nlet name=\"Lancer custom\"\nlet option=\"interface\" // \"simple\" pour éviter d'avoir une interface\n//Raccoucis possibles : @cou @int @cha @ad @fo @att @prd @lvl @pr @prm @esq @rm @mphy @mpsy\n//----------------------------------------------------//\n\nif (game.naheulbeuk.macros.getSpeakersActor() == null) { return }\nconst actorSource = game.naheulbeuk.macros.getSpeakersActor()\nlet datasetRoll = {}\ndatasetRoll.dice = dice\ndatasetRoll.diff = diff\ndatasetRoll.name = name\nlet itemRoll={}\ngame.naheulbeuk.macros.onRoll(actorSource,itemRoll,datasetRoll, option)","folder":null,"sort":0,"flags":{"core":{"sourceId":"Macro.Vt59LtIyk71j08E3"}},"ownership":{"default":0,"OUcPs2xihm1UvIIi":3},"_stats":{"systemId":"naheulbeuk","systemVersion":"2.0.0.0","coreVersion":"10.288","createdTime":null,"modifiedTime":1668096451792,"lastModifiedBy":"0E9CYtfvZEhk1ACo"}}
{"name":"Compétences","type":"script","author":"O2PVKZofn8ACxINz","img":"icons/svg/book.svg","scope":"global","command":"game.naheulbeuk.macros.competence_display()","folder":null,"sort":0,"flags":{"core":{"sourceId":"Macro.xvI1FlcMjnfSP2Ho"}},"_id":"qGAez34WnNZikDl4","ownership":{"default":0,"O2PVKZofn8ACxINz":3},"_stats":{"systemId":"naheulbeuk","systemVersion":"2.0.0.0","coreVersion":"10.288","createdTime":null,"modifiedTime":1668096451602,"lastModifiedBy":"0E9CYtfvZEhk1ACo"}}
{"name":"Tirer un élément aléatoire d'un compendium","type":"script","author":"OUcPs2xihm1UvIIi","img":"icons/svg/sun.svg","scope":"global","command":"game.naheulbeuk.macros.compendiumAlea();","folder":null,"sort":0,"flags":{"core":{"sourceId":"Macro.pyMs0vTmGs57UW06"}},"_id":"qbj1lmTMNjqc7h6L","ownership":{"default":0,"OUcPs2xihm1UvIIi":3},"_stats":{"systemId":"naheulbeuk","systemVersion":"2.0.0.0","coreVersion":"10.288","createdTime":null,"modifiedTime":1668096452439,"lastModifiedBy":"0E9CYtfvZEhk1ACo"}}
